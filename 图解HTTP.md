一、了解Web及网络基础
1. 网络基础TCP/IP协议族
   * TCP/IP协议族的分层管理：应用层、传输层、网络层和数据链路层。好处：当某个地方需要改变设计时，只要把变动的层换掉即可，不必把所有部分整体换掉。

   * 应用层： 决定了向用户提供应用服务时通信的活动。TCP/IP协议族内预存了各类通用的应用服务，比如FTP(文件传输协议),DNS(域名系统)，HTTP协议也处于应用层。
   * 传输层： 对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。传输层有两个性质不同的协议：TCP 和 UDP。
   * 网络层： 用来处理网络上流动的数据包。数据包是网络传输的最小数据单位。网络层规定了通过怎样的路径到达对方计算机，并把数据包传送给对方。网络层在与对方计算机之间通过多台计算机或网络设备进行传输时，在众多的选项内选择一条传输路线。
   * 链路层： 用来处理网络连接的硬件部分，包括控制操作系统、硬件的设备驱动、NIC(网络适配器，即网卡),及光纤等一切硬件范畴。

   * TCP/IP通信传输流：
      * 首先作为客户端作为发送端，在应用层（HTTP协议)发出一个想看某个Web页面HTTP请求。
      * 接着，在传输层(TCP协议)把从应用层接受到的数据(HTTP请求报文)进项分割，并在各个报文上打上标记序号及端口号后发送给网络层。
      * 在网络层(IP协议)，增加作为通信目的地的MAC地址后转发给链路层。
      * 发送端每通过一层则添加该层所属的首部信息，接收端每通过一层删除所属的首部信息。
      * 接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层，才算真正接收到客户端发来的HTTP请求。

2. 与HTTP密切相关的协议：TCP、IP和DNS

   * 负责传输的的IP协议： IP协议位于网络层，IP协议是一种协议名称，不要和IP地址搞混。IP协议的作用是把各种数据包传送给对方，其中包括两个重要的条件，IP地址和MAC地址。IP地址指明了节点被分配到的地址，IP地址可以变换；MAC地址是指网卡所属的固定地址，MAC地址基本上不可变换。IP地址可以和MAC地址进行配对。IP间的通信依赖MAC地址，在进行网络设备的中转时，会利用下一站中转设备的MAC地址来搜索下一个中转目标。这时会采用ARP协议，用于解析地址，根据通信方的IP地址就能反查出对应的MAC地址。

   * 确保可靠性的TCP协议： TCP协议位于传输层，提供可靠的字节流服务。所谓字节流服务，就是将大块的数据分割成以报文段为单位的数据包进行管理。可靠的传输服务是指，TCP协议可以确认数据是否最终送达到对方。
      * 三次握手：发送端发送一个带SYN标志的数据包给对方，接收端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认信息，而发送端会再回传一个带ACK标志的数据包，代表握手结束。

   * 负责域名解析的DNS服务：DNS和HTTP协议一样位于应用层，它提供域名到IP地址之间的解析服务

   * 各种协议与HTTP协议的关系： HTTP协议生成针对目标Web服务器的HTTP请求报文；通过DNS服务根据目标服务器的域名解析到它的IP地址；TCP协议将HTTP请求按序号分割成报文段，把每个报文段可靠的传输给对方。IP协议搜索对方的地址，一边中转一边传送。接收端的TCP协议从对方接受报文段，按序号以原来的顺序重组请求报文，HTTP协议对Web服务器请求的内容进行处理，请求的处理结果也同样利用TCP/IP通信协议向接收端回传。

   * URI和URL： URL是统一资源定位符，是使用Web浏览器访问Web页面时输入网址。URI是统一资源标识符，是由某个协议方案表示的资源的定位标识符，协议方案就是访问资源使用的协议类型名称。URI用字符串标识某一互联网资源，而URL表示资源的地点(互联网上所处的位置),可见URL是URI的子集。
      * URI格式：相对URL是指从浏览器中基本的URI处指定的URL,形如/image/logo.gif。
      * 绝对URI格式： http://user:pass@www.example.jp:80/dir/index.html?uid=1#ch1
         * 协议方案名： http://
         * 登录信息：user:pass 指定用户名和密码作为从服务器端获取资源时必要的登录信息。可选项。
         * 服务器地址： www.example.jp 可以是hackr.jp这种DNS可以解析的名称，也可以是IP4、IP6地址名。必选项。
         * 服务器端口号： 80 指定服务器连接的网络端口号。可选项，若不选则用默认端口。
         * 带层次的文件路径： /dir/index.html 指定服务器上的文件路径来定位特指资源。
         * 查询字符串： uid=1 针对已指定的文件路径内的资源，可以使用查询字符串传入任意参数。
         * 片段标识符： 可标记出已获取的资源中的子资源。 可选项。

二、 简单的HTTP协议
1. 告知服务器意图的HTTP方法
   * GET:获取资源，用来请求访问已被URI识别的资源。
   * POST: 传输实体主体
   * PUT: 传输文件，要求在请求报文的主体中包含文件的内容，然后保存到请求URI指定的位置。
   * HEAD: 获得报文首部，用于确认URI的有效性及资源更新的日期等
   * DELETE: 删除文件，按请求URI删除指定的资源。
   * OPTIONS: 询问支持的方法，查询针对请求URI指定的资源支持的方法。
   * TRACE: 追踪路径，让Web服务器端将之前的请求通信环回给客户端。客户端通过TRACE方法可以查询发送出去的请求是怎样被加工修饰的。
   * CONNECT: 要求用隧道协议连接代理，要求在与代理服务器通信时建立隧道，实现用隧道进行TCP通信。

2. 持久连接节省通信量： 当使用浏览器浏览一个包含多张图片的HTML页面，在访问HTML页面资源的同时，也会请求图片资源。因此每次请求都会造成所谓的TCP连接的建立和断开，增加通信量的开销。
* 持久连接： 只要任意一段没有明确提出断开连接，则保持TCP连接状态。

3. 管线化： 持久连接使得多数请求以管线化方式发送成为可能。以前发送请求要等到接收到回应，才能发送下一个请求。管线化技术出现后，不用等待响应可直接发送下一条请求。

4. 使用Cookie的状态管理： HTTP是无状态协议，他不对之前发生过的请求和响应状态进行管理，无法根据之前的状态进行本次的请求处理。假设要求登录的web页面本身无法进行状态的管理，那么每次跳转页面都要再次登录或是在请求报文中附加参数来管理登录状态。无状态协议的优点是可减少服务器CPU及内存资源的消耗。
   Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部信息，通知客户端保存Cookie。当客户端下一次向该服务器发送请求时，客户端就会自动在请求报文中加入Cookie值发送出去。服务器端发现客户端发送来的Cookie后，会去检查是哪个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。


三、 HTTP报文内的HTTP信息

1. HTTP报文： 用户HTTP协议交互的信息被称为HTTP报文。HTTP报文大致可以分为报文首部和报文主体两块，二者由最初出现的空行(CR+LF)来划分。通常，并不一定要有报文主体。

2. 请求报文及响应报文的首部结构
   * 请求行：包含用于请求的方法，请求URI和HTTP版本。
   * 状态行：包含表明响应结果的状态码，原因短语和HTTP版本。
   * 首部字段： 包含表示请求和响应的各种条件和属性的各类首部。一般有四种首部：通用首部、请求首部、响应首部、实体首部。
   * 其他： 可能包含HTTP的RFC里未定义的首部(Cookie等)

3. 编码提升传输速率

   1. 报文主体和实体主体的差异
    * 报文：是HTTP通信中的基本单位，有8位组字节流组成，通过HTTP通信传输。
    * 实体：作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。
    * HTTP报文的主体用于传输请求或响应的实体主体。通常报文主体等于实体主体。只有在传输时进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。

   2. 压缩传输的内容编码：HTTP协议中有一种称为内容编码的功能可进项压缩。内容编码指明应用在实体内容上的编码格式，并保存实体信息原样压缩。内容编码后的实体有客户端接收并负责解码。

   3. 分割发送的分块传输编码： 在HTTP通信过程中，请求的编码实体资源尚未完全传输完成之前，浏览器无法显示请求页面。当传输大容量数据时，通过把数据分割成多块，能过让浏览器逐步显示页面。这种把实体主体分块的功能称为分块传输编码。分块传输编码会将实体主体分成多个块，每一块都会用十六进制来标记块的大小，而实体主体的最后一块会使用“0(CR+LF)”来标记。实体主体会被客户端接收并解码，恢复成编码前的实体主体。

4. 发送多种数据的多部分对象集合：HTTP协议中采纳了多部分对象集合，发送的一份报文主体内可含有多类型实体。通常是在图片或文本文件等上传时使用。
   * multipart/form-data:在Web表单文件上传时使用。
   * multipart/byteranges:状态码206(Partial Content, 部分内容)响应报文包含了多个范围的内容时使用。
在HTTP报文中使用多部分对象集合时，要在首部字段里加上Content-type。使用boundary字符串来划分多部分对象集合指明的各类实体。在boundary字符串指定的各个实体的起始行之前插入“--”标记，而在多部分对象集合对应的字符串的最后插入“--”标记作为结束。
多部分对象集合的每一个部分类型中，都可以含有首部字段，可以在某个部分中嵌套使用多部分对象组合。

5. 获取部分内容的范围请求： 要实现从下载中断处恢复下载，需要指定下载的实体范围。像这样指定范围发送的请求叫做范围请求，使用Range来指定资源的byte范围。
   * 5001-10000字节
    Range: bytes=5001-10000
   * 从5001字节之后全部的
    Range: bytes=5001-
   * 从一开始到3000字节和5000~7000字节的多重范围
    Range: bytes=-3000,5000-7000
  
  针对范围请求，响应会返回状态码为206 Partial Content的响应报文。对于多重范围请求，响应会在首部字段Content-Type标明multipart/byteranges后返回响应报文。如果服务器端无法响应范围请求，则返回状态码为200 OK和完整的实体内容。

6. 内容协商返回最合适内容：当浏览器的默认语言为英文或中文，访问相同的URI的Web页面时，则会显示对应的英文或是中文版的Web页面。
   内容协商机制是指客户端和服务器端就响应的资源内容进项交涉，然后提供给客户端最合适的资源。内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准，以及请求报文中某些首部字段为判断的基准。内容协商技术有以下3种类型：
   * 服务器驱动协商：以请求的首部字段为参考，在服务器端自动处理。但对用户来说，不一定能筛选出最优内容。
   * 客户端驱动协商：用户从浏览器显示的可选项列表中手动选择。还可以利用JS脚本在Web页面上自动选择。
   * 透明协商： 是服务器驱动协商和客户端驱动协商的结合体。



  
   




